@todo:

    resolve:
        - staff view users
        - due date --> if faculty: 31st may else: 7 days later

    create:
        - return book
        - fine calculation
        

    display users
    search books/ users
    precedure to find students who are due to return today + overdue
    email
    trigger --> to send an email on the due database
    create transaction table -> return date should be 7 days from the day it was issued.




//updateBooks.php
        <?php
            session_start();

            // Include necessary files (e.g., connection and functions)
            include("../connection.php");
            include("../functions.php");

            // Initialise variable to track if email exists
            $ISBN_exists = false;

            // Check if the user has clicked on the post button
            if ($_SERVER['REQUEST_METHOD'] == "POST") {
                // Something was posted, collect the data from post variable
                if(isset($_POST['ISBN'])) {
                    $ISBN = $_POST['ISBN'];

                    // Query the database to check if the email exists
                    $query = "SELECT * FROM books WHERE book_no = '$ISBN'";
                    $result = mysqli_query($con, $query);

                    if (mysqli_num_rows($result) > 0) {
                        // Email exists, flag it true
                        $ISBN_exists = true;

                        // Retrieve existing user details from the database
                        $book = mysqli_fetch_assoc($result);

                        // Check if user details were found
                        if (!$book) {
                            // User not found in the database
                            // Handle the error accordingly (e.g., display an error message)
                            echo "Book not found.";
                            exit; // Terminate script execution
                        }
                    }
                }

                // Handle the second POST request for updating user details
                if ($ISBN_exists && isset($_POST['new_book_no']) && isset($_POST['new_book_title']) && isset($_POST['new_book_author']) && isset($_POST['new_book_subject']) && isset($_POST['new_total_copies']) && isset($_POST['new_available_copies'])) {
                    $new_ISBN = $_POST['new_ISBN'];
                    $new_book_title = $_POST['new_book_title'];
                    $new_book_author = $_POST['new_book_author'];
                    $new_book_subject = $_POST['new_book_subject'];
                    $new_total_copies = $_POST['new_total_copies'];
                    $new_borrowed_copies = $_POST['new_borrowed_copies'];
                    $new_available_copies = $_POST['new_available_copies'];

                    // Update user details in the database
                    $query = "UPDATE books SET ISBN = '$new_ISBN', book_title = '$new_book_title', book_author = '$new_book_author', book_subject = '$new_book_subject', total_copies = '$new_total_copies', borrowed_copies = '$new_borrowed_copies', available_copies = '$new_available_copies' WHERE book_no = '$ISBN'";
                    $result = mysqli_query($con, $query);

                    if ($result) {
                        // User details updated successfully
                    
                        // Display the alert box  
                        echo '<script>alert("Book update is successful!")</script>';
                        
                        // Redirect after a short delay
                        echo '<script>window.setTimeout(function(){ window.location.href = "staffHomepage.php"; }, 400);</script>';
                        exit; // Terminate script execution
                    } else {
                        // Error occurred while updating user details
                        // Display an error message or handle the error accordingly
                        echo "Error updating user details: " . mysqli_error($con);
                    }
                }
            }
            ?>

            <!DOCTYPE html>
            <html lang="en">

            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Admin Update</title>
            </head>

            <body>
                <div>
                    <!-- Form for entering user email -->
                    <form action="" method="post">
                        <input id="text" type="text" name="ISBN" placeholder="Enter ISBN."><br><br>
                        <input id="button" type="submit" value="Search">
                    </form>
                </div>

                <?php if ($ISBN_exists): ?>
                <!-- Display the second half of the form only if email exists -->
                <div>
                    <!-- Update user details form -->
                    <form action="" method="post">
                        <!-- Add input fields for updating user details -->

                        <input id="text" type="text" name="new_ISBN" value="<?php echo $book['ISBN']; ?>"><br><br>
                        <input id="text" type="text" name="new_book_title" value="<?php echo $book['book_title']; ?>"><br><br>
                        <input id="text" type="text" name="new_book_author" value="<?php echo $book['book_author']; ?>" ><br><br>
                        <input id="text" type="text" name="new_book_subject" value="<?php echo $book['book_subject']; ?>" ><br><br>
                        <input id="text" type="text" name="new_total_copies" value="<?php echo $book['total_copies']; ?> "><br><br>
                        <input id="text" type="text" name="new_borrowed_copies" value="<?php echo $book['borrowed_copies']; ?>"><br><br>
                        <input id="text" type="text" name="new_available_copies" value="<?php echo $book['available_copies']; ?>"><br><br>

                        <!-- Add hidden input field to store user_email -->
                        <input type="hidden" name="ISBN" value="<?php echo $ISBN; ?>">

                        <!-- Add more input fields as needed -->
                        <input id="button" type="submit" value="Update">
                    </form>
                </div>
                <?php endif; ?>
            </body>

            </html>










 <?php
        session_start();

        // Include necessary files (e.g., connection and functions)
        include ("connection.php");
        include ("functions.php");

        // initialise variable to track if email exists
        $email_exists = false;


        // check if the user has clicked on the post button
        if ($_SERVER['REQUEST_METHOD'] == "POST") {
            // something was posted, collect the data from post variable
            $user_email = $_POST['user_email'];

            // query the database to check if the email exists
            $query = "SELECT * FROM userss WHERE user_email = '$user_email'";
            $result = mysqli_query($con, $query);

            if (mysqli_num_rows($result) > 0) {
                // email exists, flag it true
                $email_exists = true;

                // @todo : add alert message
            }




            if ($email_exists == true) {
                // Retrieve existing user details from the database
                $query = "SELECT * FROM userss WHERE user_email = '$user_email'";
                $result = mysqli_query($con, $query);
                $user = mysqli_fetch_assoc($result);

                // Check if user details were found
                if (!$user) {
                    // User not found in the database
                    // Handle the error accordingly (e.g., display an error message)
                    echo "User not found.";
                    exit; // Terminate script execution
                }

                if ($_SERVER['REQUEST_METHOD'] == "POST") {
                    // Update user details in the database
                    $query = "UPDATE userss SET user_name = '$new_user_name', user_email = '$new_user_email' WHERE user_email = '$user_email'";
                    $result = mysqli_query($con, $query);

                    if ($result) {
                        // User details updated successfully
                        // Redirect the user to a success page or display a success message
                        header("Location: adminHomepage.php");
                        exit; // Terminate script execution
                    } else {
                        // Error occurred while updating user details
                        // Display an error message or handle the error accordingly
                        echo "Error updating user details: " . mysqli_error($con);
                    }
                }
            }


        }

    ?>

//updateUsers.php
    <div>
            <!-- Update user details form -->
            <form action="" method="post">
                <!-- Add input fields for updating user details -->
                <!-- Populate the value attribute with existing values -->
                <input id="text" type="text" name="new_college_id" placeholder="New College ID"
                    value="<?php echo $user['college_id']; ?>"><br><br>
                <input id="text" type="text" name="new_user_fname" placeholder="New First name"
                    value="<?php echo $user['user_fname']; ?>"><br><br>
                <input id="text" type="text" name="new_user_lname" placeholder="New last Name"
                    value="<?php echo $user['user_lname']; ?>"><br><br>
                <input id="text" type="email" name="new_user_email" placeholder="New Email"
                    value="<?php echo $user['user_email']; ?>"><br><br>
                <input id="text" type="text" name="new_user_phone" placeholder="New Phone no"
                    value="<?php echo $user['user_phone']; ?>"><br><br>
                <!-- Add hidden input field to store user_email -->
                <input type="hidden" name="user_email" value="<?php echo $user_email; ?>">
                <!-- Add more input fields as needed -->
                <input id="button" type="submit" value="Update">

//removeUsers.php
    <?php

        session_start();

        include("../connection.php");  //connecting to the database
        include("../functions.php");   //calling the functions

        // check if the user has clicked on the post button
        if($_SERVER['REQUEST_METHOD'] == "POST"){
            // something was posted
            // collect the data from post variable

            $ISBN = $_POST['user_email'];

            // Check if the book number is set and not empty
            if (!empty($ISBN)) {
                // Sanitize the book number to prevent SQL injection
                $ISBN = mysqli_real_escape_string($con, $ISBN);

                // Construct the DELETE query
                $query = "DELETE FROM users WHERE user_email = '$ISBN'";

                // Execute the DELETE query
                if (mysqli_query($con, $query)) {
                    // Book successfully removed
                    // display alert box
                    echo '<script>alert("User removed successfully!")</script>';
                    
                    // Redirect after a short delay
                echo '<script>window.setTimeout(function(){ window.location.href = "adminHomepage.php"; }, 400);</script>';
                    exit;
                
                } else {
                    // Error in deleting the book
                    echo "Error: " . mysqli_error($con);
                }
            } else {
                // Book number is not provided or empty
                echo "Please enter the user email.";
            }
        }

    ?>

    <!DOCTYPE html>
    <html lang="en">

        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Remove users</title>
        </head>

        <body>
            <style type="text/css">
                #text {
                    height: 25px;
                    border-radius: 5px;
                    padding: 4px;
                    border: solid thin #aaa;
                    width: 100%;
                }

                #button {
                    padding: 10px;
                    width: 100px;
                    color: white;
                    background-color: cadetblue;
                    border: none;
                }

                #box {
                    background-color: gray;
                    margin: auto;
                    width: 300px;
                    padding: 20px;
                }
            </style>

            <div id="box">
                <form action="" method="post">
                    <div style="font-size: 20px; margin: 10px;color:white">
                        Remove book
                    </div>

                    <input id="text" type="email" name="user_email" placeholder="Enter user email..."><br><br>

                    <input id="button" type="submit" value="Remove"><br><br>

                    
                </form>
            </div>


        </body>

    </html>

<!DOCTYPE html>
    <html lang="en">

        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Admin Update</title>
        </head>

        <body>
            <div>
                <!-- Form for entering user email -->
                <form action="" method="post">
                    <input id="text" type="email" name="user_email" placeholder="Enter User Email"><br><br>
                    <input id="button" type="submit" value="Search">
                </form>
            </div>

            <?php if ($email_exists): ?>
                <!-- Display the second half of the form only if email exists -->
                <div>
                    <!-- Update user details form -->
                    <form action="updateUser.php" method="post">
                        <!-- Add input fields for updating user details -->
                        <!-- For example: -->
                        <input id="text" type="text" name="new_user_name" placeholder="New Name"><br><br>
                        <input id="text" type="email" name="new_user_email" placeholder="New Email"><br><br>
                        <!-- Add more input fields as needed -->
                        <input id="button" type="submit" value="Update">
                    </form>
                </div>
            <?php endif; ?>
        </body>

    </html>



    <?php
        session_start();

        // Include necessary files (e.g., connection and functions)
        include("connection.php");
        include("functions.php");

        // Check if the user is logged in
        // if (!isset($_SESSION['user_id'])) {
        //     // Redirect the user to the login page if not logged in
        //     header("Location: login.php");
        //     exit; // Terminate script execution
        // }

        // initialise variable to track if email exists
        $email_exists = false;
        

        // check if the user has clicked on the post button
        if ($_SERVER['REQUEST_METHOD'] == "POST") {
            // something was posted, collect the data from post variable
            $user_email = $_POST['user_email'];

            // query the database to check if the email exists
            $query = "SELECT * FROM userss WHERE user_email = '$user_email'";
            $result = mysqli_query($conn, $query);

            if(mysqli_num_rows($result) > 0) {
                // email exists, flag it true
                $email_exists = true;
            }




            // Retrieve form data
            // $user_id = $_SESSION['user_id']; // Assuming user ID is stored in the session
            // $user_name = $_POST['user_name'];
            // $user_email = $_POST['user_email'];
            // // Add more fields as needed

            // // Perform validation on the input data
            // // For example, ensure that required fields are not empty, validate email format, etc.

            // // Update user details in the database
            // $query = "UPDATE userss SET user_name = '$user_name', user_email = '$user_email' WHERE user_id = '$user_id'";
            // $result = mysqli_query($con, $query);

            // if ($result) {
            //     // User details updated successfully
            //     // Redirect the user to a success page or display a success message
            //     header("Location: profile.php");
            //     exit; // Terminate script execution
            // } else {
            //     // Error occurred while updating user details
            //     // Display an error message or handle the error accordingly
            //     echo "Error updating user details: " . mysqli_error($con);
            // }
        }

        // Retrieve existing user details from the database
        $user_id = $_SESSION['user_id']; // Assuming user ID is stored in the session
        $query = "SELECT * FROM users WHERE user_id = '$user_id'";
        $result = mysqli_query($con, $query);
        $user = mysqli_fetch_assoc($result);

        // Check if user details were found
        if (!$user) {
            // User not found in the database
            // Handle the error accordingly (e.g., display an error message)
            echo "User not found.";
            exit; // Terminate script execution
        }
    ?>

<!DOCTYPE html>
    <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Admin Update</title>
        </head>
        <body>
        <div>
                <!-- Form for entering user email -->
                <form action="" method="post">
                    <input id="text" type="email" name="user_email" placeholder="Enter User Email"><br><br>
                    <input id="button" type="submit" value="Search">
                </form>
            </div>

            <?php if($email_exists): ?>
            <!-- Display the second half of the form only if email exists -->
            <div>
                <!-- Update user details form -->
                <form action="updateUser.php" method="post">
                    <!-- Add input fields for updating user details -->
                    <!-- For example: -->
                    <input id="text" type="text" name="user_name" placeholder="New Name"><br><br>
                    <input id="text" type="email" name="user_email" placeholder="New Password"><br><br>
                    <!-- Add more input fields as needed -->
                    <input id="button" type="submit" value="Update">
                </form>
            </div>
            <?php endif; ?>
        </body>
    </html>





    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Update User Details</title>
    </head>
    <body>
        <h1>Update User Details</h1>
        <form action="" method="post">
            <label for="user_name">Name:</label>
            <input type="text" id="user_name" name="user_name" value="<?php echo $user['user_name']; ?>"><br><br>

            <label for="user_email">Email:</label>
            <input type="email" id="user_email" name="user_email" value="<?php echo $user['user_email']; ?>"><br><br>

            <!-- Add more fields as needed -->

            <input type="submit" value="Update">
        </form>
    </body>
    </html>